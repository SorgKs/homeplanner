Документ описывает детальный план разработки следующей версии HomePlanner (vNext). Структура плана ориентирована на модульность, тестируемость и прозрачную коммуникацию внутри команды.

## 1. Цели релиза
- Запуск расширенного планировщика задач с поддержкой групповых календарей и индивидуальных напоминаний.
- Обеспечение единого пользовательского опыта в веб- и Android-клиентах.
- Повышение надёжности системы за счёт улучшенного мониторинга, логирования и покрытия тестами.
- Подготовка инфраструктуры к масштабированию (CI/CD, автоматические smoke-наборы).

## 2. Область охвата
- **Backend**: расширение модели задач, улучшение API синхронизации, добавление веб-сокетов для обновлений в реальном времени.
- **Frontend (Web)**: новый интерфейс календаря, редактор повторяющихся задач, улучшенные сценарии фильтрации.
- **Android**: переработанное главное окно, оффлайн-синхронизация, управление уведомлениями.
- **Инфраструктура**: обновление CI/CD, мониторинг логов, автоматические smoke-тесты.

## 3. Основные этапы и сроки

### Этап 1. Архитектурное проектирование (1 неделя) — завершён
- Определены изменения в схемах БД и миграциях (см. `docs/ARCHITECTURE_vNext.md#изменения-в-базе-данных`).
- Спроектированы API-контракты (OpenAPI) и согласованы с фронтендом и мобильной командой (`docs/ARCHITECTURE_vNext.md#api-контракты`).
- Обновлены диаграммы компонентов и взаимодействий (`docs/ARCHITECTURE_vNext.md#компонентная-архитектура`).
- Подготовлен план интеграционных тестов (`docs/ARCHITECTURE_vNext.md#план-интеграционных-тестов`).
- Зафиксировано, что отсутствующий файл `docs/ARCHITECTURE_vNext.md` должен быть создан или ссылки заменены на фактические источники (диаграммы и спецификации) до старта этапа 2.

### Этап 2. Реализация подсистем (последовательное выполнение)
- **Шаг 1. Backend**:
  - Реализовать новые эндпоинты (групповые календари, повторяемость) и обновить сервисный слой.
  - Обновить миграции БД, убедиться в консистентности локального формата дат и namespace `/api/v0.2/` во всех связанных документах (`docs/ARCHITECTURE_vNext.md`, `docs/SYNC_POLICY.md`, OpenAPI-спека).
  - Добавить асинхронные уведомления (WebSocket/broker) и покрыть бизнес-логику тестами (`tests/`).
- **Шаг 2. Frontend (Web)**:
  - Имплементировать новый календарь, оповещения и фильтры, интегрировавшись с обновлённым backend API.
  - Реализовать offline-aware слой с учётом согласованного формата данных.
  - Добавить unit/integration тесты и e2e smoke-набор.
- **Шаг 3. Android**:
  - Обновить UI, поддержать оффлайн-сценарии и настройки уведомлений, применяя общую стратегию синхронизации.
  - Покрыть функциональность инструментальными и UI-тестами.
- **Шаг 4. Общая проверка**:
  - Сверить поведение клиентов и backend на предмет конфликтов, ревизий и soft-lock.
  - Актуализировать документацию (README, CHANGELOG, guides), отметить выполненные шаги в issue-трекере.

### Этап 3. Интеграция и системное тестирование (2 недели)
- Выполнить интеграционные прогоны backend + web + Android.
- Запустить smoke-наборы согласно `docs/TESTING_CONVENTIONS.md`.
- Провести нагрузочное тестирование критичных эндпоинтов.
- Зафиксировать дефекты, приоритизировать и закрыть критические блокеры.

### Этап 4. Документация и подготовка релиза (1 неделя)
- Обновить `README.md`, `CHANGELOG_HISTORY.md`, `docs/API.md`, `docs/DEVELOPMENT.md`.
- Подготовить релизные заметки, инструкции для пользователей.
- Согласовать план деплоя, обновить конфиги CI/CD.
- Выполнить релиз-кандидат, провести регрессионное тестирование.

## 4. Разделение ответственности
- **Единственный разработчик**: выполняет архитектурные задачи, реализацию backend/web/Android, тестирование и обновление документации. Отвечает за согласование API и форматов данных между компонентами.
- **Product Owner**: функции выполняет тот же разработчик; он формирует и утверждает scope, acceptance criteria, roadmap, принимает результат этапов и выступает основным пользователем системы на момент подготовки релиза.
- **Внешние участники (по необходимости)**: DevOps, маркетинг, QA привлекаются точечно (доступ к инфраструктуре, аналитика, выпуск заметок). Все договорённости фиксируются в issue-трекере.

## 5. Метрики качества и готовности
- Покрытие unit-тестами: ≥85% для сервисов, ≥75% для UI-компонентов.
- Успешное прохождение всех smoke-наборов (web, Android, backend API).
- Время ответа ключевых эндпоинтов ≤ 200 мс под нагрузкой (p95).
- Залогированные ошибки уровня ERROR — не более 5 в сутки на 1000 активных пользователей.
- Отсутствие открытых блокирующих дефектов (severity Critical/High).

## 6. Риски и меры снижения
- **Смена API**: риск несовместимости — планировать backward compatibility, добавить версионирование.
- **Флейки UI-тестов**: стабилизировать селекторы, использовать data-testid.
- **Нагрузка на сервер**: внедрить кэширование и мониторинг (Prometheus/Grafana).
- **Зависимость от внешних сервисов**: реализовать fallback и ретраи.

## 7. План коммуникаций
- Еженедельные синхронизации по направлениям (backend, frontend, mobile).
- Общий демо-слот в конце каждой итерации (каждые 2 недели).
- Канал #release-vnext для оперативной координации.
- Ежедневные статусы в issue-трекере, обновление диаграмм прогресса.

## 8. Дополнительные действия
- Подготовить требования к аналитике (events, telemetry) совместно с маркетингом; критерий готовности — список событий и схем, зафиксированный в `docs/analytics.md`.
- Актуализировать политику миграции данных и отката, ссылаяcь на существующую версию в GitHub; критерий — чек-лист действий при необходимости возврата, добавленный в `docs/SYNC_POLICY.md`.
- Провести knowledge sharing по новым механизмам (WebSocket, offline); критерий — опубликованная запись сессии или конспект в `docs/knowledge_base/`.
- **Политика синхронизации**: определить используемые протоколы (REST + WebSocket, брокер сообщений), объём и формат локального кэша для web/Android, требования к максимальной задержке доставки событий (p95 ≤ 3 секунды) и правила повторной доставки; критерий — обновлённый документ `docs/SYNC_POLICY.md` с отметкой о ревизии.
- **Конфликтные сценарии**: описать стратегию разрешения (Last Write Wins, версионирование записей, soft-lock), требования к уведомлению пользователя и логированию конфликтов; критерий — наличие раздела «Конфликты» в документации клиентов.
- **Offline-first**: задать поведение клиентов при отсутствии сети, лимиты хранения (7 дней истории), очередь синхронизации и приоритеты данных; критерий — чек-лист сценариев в тестовом плане и отражение настроек в конфигурации клиентов.
- **Версионирование API**: подтвердить использование namespace `/api/v0.2/` во всех документах и клиентах, зафиксировать ссылку на актуальную OpenAPI-спеку (`backend/api/openapi_0_2.yaml`).
- **Формат времени**: закрепить использование локального формата проекта без таймзоны для всех обменов, обновить упоминания в архитектурном документе и спецификациях.
- **Статус развёртывания**: проект ещё не разворачивался в продуктивной среде; перед релизом требуется добавить checklist smoke-проверок для первого ввода в эксплуатацию.

---
Документ актуализируется по мере изменения приоритетов. Ответственный за поддержание плана — Tech Lead Backend.

