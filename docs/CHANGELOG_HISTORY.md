# –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–¥–∞—á

## –†–µ–∑—é–º–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∑–∞–¥–∞—á–∞–º–∏.

## –î–∞—Ç–∞

2025-01-15

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### Backend

#### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
1. **backend/models/task_history.py** - –º–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–¥–∞—á
   - Enum TaskHistoryAction: CREATED, FIRST_SHOWN, CONFIRMED, UNCONFIRMED, EDITED, DELETED, ACTIVATED, DEACTIVATED
   - –ú–æ–¥–µ–ª—å TaskHistory —Å –ø–æ–ª—è–º–∏: task_id, action, action_timestamp, iteration_date, metadata
   
2. **backend/schemas/task_history.py** - Pydantic —Å—Ö–µ–º—ã –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
   - TaskHistoryBase, TaskHistoryCreate, TaskHistoryResponse

3. **backend/services/task_history_service.py** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
   - create_history_entry - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   - get_task_history - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–¥–∞—á–∏
   - log_action - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
   - log_task_created - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è
   - log_task_confirmed - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - log_task_unconfirmed - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - log_task_first_shown - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–∫–∞–∑–∞

4. **backend/routers/task_history.py** - API —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
   - GET /api/v1/tasks/{task_id}/history - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–¥–∞—á–∏

5. **alembic/versions/a1b2c3d4e5f6_add_task_history_table.py** - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã task_history —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–æ–º

#### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
1. **backend/main.py**
   - –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏ TaskHistory –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Base
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ task_history

2. **backend/models/__init__.py**
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç TaskHistory

3. **backend/services/task_service.py**
   - create_task: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
   - complete_task: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - update_task: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å old/new –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

4. **alembic/env.py**
   - –ò–º–ø–æ—Ä—Ç TaskHistory –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π

### Frontend

#### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
1. **frontend/api.js**
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ tasksAPI.getHistory(id) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–¥–∞—á–∏

2. **frontend/index.html**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ #history-modal –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏

3. **frontend/app.js**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üìú" –≤ –∫–∞—Ä—Ç–æ—á–∫—É –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏
   - –§—É–Ω–∫—Ü–∏—è viewTaskHistory(taskId) - –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π
   - –§—É–Ω–∫—Ü–∏—è closeHistoryModal() - –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –¥–µ–π—Å—Ç–≤–∏–π
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (old ‚Üí new)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
1. **docs/TASK_HISTORY.md** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∏—Å—Ç–µ–º–µ –∏—Å—Ç–æ—Ä–∏–∏
2. **docs/CHANGELOG_HISTORY.md** - —ç—Ç–æ—Ç —Ñ–∞–π–ª

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –ø–æ–ª–µ `metadata` –≤ –º–æ–¥–µ–ª–∏ TaskHistory, –Ω–æ —ç—Ç–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è –≤ SQLAlchemy Declarative API, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞.

**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –ø–æ–ª–µ `metadata` –≤ `meta_data` –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö:
- backend/models/task_history.py
- backend/schemas/task_history.py
- alembic/versions/a1b2c3d4e5f6_add_task_history_table.py
- frontend/app.js

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

1. –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

2. –¢–µ–ø–µ—Ä—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–¥–∞—á–∞–º–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

3. –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìú" –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–¥–∞—á–∏

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìú" –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –µ—ë –∏—Å—Ç–æ—Ä–∏–∏.

## API

–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–¥–∞—á–∏:
```http
GET /api/v1/tasks/1/history
```

–û—Ç–≤–µ—Ç:
```json
[
  {
    "id": 1,
    "task_id": 1,
    "action": "created",
    "action_timestamp": "2025-01-15T10:00:00",
    "iteration_date": null,
    "metadata": "{...}"
  },
  {
    "id": 2,
    "task_id": 1,
    "action": "confirmed",
    "action_timestamp": "2025-01-15T11:00:00",
    "iteration_date": "2025-01-15T09:00:00",
    "metadata": null
  }
]
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ò—Å—Ç–æ—Ä–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á, –≤–∫–ª—é—á–∞—è —É–¥–∞–ª—ë–Ω–Ω—ã–µ. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –ø–æ–ª–µ `task_id` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `NULL` (ON DELETE SET NULL), —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é.
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- –í—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `config/settings.toml`)
- –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º

## –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ò—Å—Ç–æ—Ä–∏—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–∏–¥ (2025-11-02)

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏
- –ò—Å—Ç–æ—Ä–∏—è —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–∏–¥ (–Ω–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ)
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã: –ø–æ –≥—Ä—É–ø–ø–µ, –ø–æ –∑–∞–¥–∞—á–µ, –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç
- –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É —Å –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏ –¥–ª—è —Ç–∏–ø–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π
- –î–ª—è –¥–µ–π—Å—Ç–≤–∏–π "–ò–∑–º–µ–Ω–µ–Ω–æ" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —á—Ç–æ –Ω–∞ —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
- –î–ª—è –¥–µ–π—Å—Ç–≤–∏–π "–°–æ–∑–¥–∞–Ω–æ", "–ò–∑–º–µ–Ω–µ–Ω–æ" –∏ "–£–¥–∞–ª–µ–Ω–æ" –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–∏—Ç–∞–µ–º—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∑–∞–¥–∞—á–∏

#### Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `comment` –≤ —Ç–∞–±–ª–∏—Ü—É `task_history` –¥–ª—è —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `last_shown_at` –≤ —Ç–∞–±–ª–∏—Ü—É `tasks` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–∫–∞–∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ `FIRST_SHOWN` –¥–ª—è –æ–¥–Ω–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç–∏: `WEEKDAYS` (–ø–Ω-–ø—Ç) –∏ `WEEKENDS` (—Å–±-–≤—Å)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ `next_due_date` –¥–ª—è —É—á—ë—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏/–¥–Ω—è –Ω–µ–¥–µ–ª–∏/–º–µ—Å—è—Ü–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
- –ò–∑–º–µ–Ω—ë–Ω `ondelete="CASCADE"` –Ω–∞ `ondelete="SET NULL"` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

#### Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üìú –ò—Å—Ç–æ—Ä–∏—è" –≤ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ –≤–∏–¥–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã –∏—Å—Ç–æ—Ä–∏–∏ –≤ `history-filters-section`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üîß –ê–¥–º–∏–Ω —Ä–µ–∂–∏–º" –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤ —Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –í –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º–µ –¥–æ—Å—Ç—É–ø–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω API endpoint –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏: `DELETE /api/v1/history/{history_id}`

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –∏–∑ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `config/settings.toml` (—Å–µ–∫—Ü–∏—è `[app]`, –ø–æ–ª–µ `timezone`)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞ –±–µ—Ä—É—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

